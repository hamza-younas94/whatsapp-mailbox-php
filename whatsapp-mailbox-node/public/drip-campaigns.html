<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drip Campaigns - WhatsApp Mailbox</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' data: https://cdnjs.cloudflare.com https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' http://whatshub.nexofydigital.com:3000 https://whatshub.nexofydigital.com:3000;">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-btn { background: linear-gradient(135deg, #128C7E 0%, #25D366 100%); }
        .gradient-btn:hover { background: linear-gradient(135deg, #0d6b5f 0%, #1fb855 100%); }
        .step-card { transition: all 0.2s; }
        .step-card:hover { transform: translateY(-2px); }
        .connector-line { position: absolute; left: 24px; top: 60px; bottom: 0; width: 2px; background: #e5e7eb; }
    </style>
</head>
<body class="bg-gray-50">
    <script>
        if (!localStorage.getItem('authToken')) window.location.href = '/login.html';
    </script>
    <script src="/js/navbar.js"></script>

    <div class="max-w-7xl mx-auto px-4 py-6">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">üíß Drip Campaigns</h1>
                <p class="text-gray-600 mt-1">Automate sequences of messages to nurture your leads</p>
            </div>
            <button onclick="showCreateModal()" 
                class="gradient-btn text-white px-6 py-3 rounded-xl font-medium shadow-lg hover:shadow-xl transition-all">
                <i class="fas fa-plus mr-2"></i>New Campaign
            </button>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-3xl font-bold text-blue-600" id="totalCampaigns">0</div>
                        <div class="text-sm text-gray-500">Total Campaigns</div>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-full">
                        <i class="fas fa-water text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-green-500">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-3xl font-bold text-green-600" id="activeCampaigns">0</div>
                        <div class="text-sm text-gray-500">Active</div>
                    </div>
                    <div class="p-3 bg-green-100 rounded-full">
                        <i class="fas fa-play-circle text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-purple-500">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-3xl font-bold text-purple-600" id="totalEnrolled">0</div>
                        <div class="text-sm text-gray-500">Contacts Enrolled</div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-full">
                        <i class="fas fa-users text-purple-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-yellow-500">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-3xl font-bold text-yellow-600" id="messagesSent">0</div>
                        <div class="text-sm text-gray-500">Messages Sent</div>
                    </div>
                    <div class="p-3 bg-yellow-100 rounded-full">
                        <i class="fas fa-paper-plane text-yellow-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Campaigns List -->
        <div class="bg-white rounded-xl shadow-sm">
            <div class="p-4 border-b flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        <input type="text" id="searchInput" placeholder="Search campaigns..." 
                            class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 w-64">
                    </div>
                    <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="">All Status</option>
                        <option value="ACTIVE">Active</option>
                        <option value="PAUSED">Paused</option>
                        <option value="DRAFT">Draft</option>
                    </select>
                </div>
            </div>
            
            <div id="campaignsList" class="divide-y">
                <div class="p-8 text-center text-gray-500">
                    <i class="fas fa-spinner fa-spin text-4xl mb-2"></i>
                    <p>Loading campaigns...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Campaign Modal -->
    <div id="campaignModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
            <div class="p-6 border-b bg-gradient-to-r from-blue-600 to-blue-700">
                <h2 id="modalTitle" class="text-2xl font-bold text-white">üíß Create Drip Campaign</h2>
                <p class="text-blue-200 text-sm mt-1">Build automated message sequences</p>
            </div>
            
            <div class="p-6 max-h-[60vh] overflow-y-auto">
                <input type="hidden" id="campaignId">
                
                <!-- Basic Info -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">Campaign Name *</label>
                        <input type="text" id="campaignName" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="e.g., Welcome Sequence">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">Trigger</label>
                        <select id="trigger" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                            <option value="CONTACT_CREATED">When contact is created</option>
                            <option value="TAG_ADDED">When tag is added</option>
                            <option value="SEGMENT_JOINED">When joins segment</option>
                            <option value="MANUAL">Manual enrollment</option>
                        </select>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-gray-700 mb-2 font-medium">Description</label>
                    <textarea id="campaignDescription" rows="2"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg"
                        placeholder="Describe this campaign's purpose"></textarea>
                </div>

                <!-- Steps Builder -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-800">üìã Campaign Steps</h3>
                        <button type="button" onclick="addStep()" 
                            class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            <i class="fas fa-plus mr-1"></i>Add Step
                        </button>
                    </div>
                    
                    <div id="stepsContainer" class="space-y-4">
                        <!-- Steps will be added here -->
                    </div>
                </div>

                <!-- Enrollment Settings -->
                <div class="bg-gray-50 rounded-xl p-4">
                    <h3 class="font-semibold text-gray-800 mb-3">‚öôÔ∏è Settings</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-2 text-sm">Exit Conditions</label>
                            <select id="exitCondition" class="w-full px-3 py-2 border rounded-lg text-sm">
                                <option value="COMPLETE">Complete all steps</option>
                                <option value="REPLY">When contact replies</option>
                                <option value="TAG_REMOVED">When tag is removed</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2 text-sm">Send Window</label>
                            <select id="sendWindow" class="w-full px-3 py-2 border rounded-lg text-sm">
                                <option value="ANYTIME">Anytime</option>
                                <option value="BUSINESS_HOURS">Business hours only</option>
                                <option value="CUSTOM">Custom hours</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t bg-gray-50 flex justify-between">
                <button type="button" onclick="hideModal()"
                    class="px-6 py-2.5 bg-white border border-gray-300 hover:bg-gray-100 text-gray-700 rounded-lg font-medium">
                    Cancel
                </button>
                <div class="flex space-x-2">
                    <button type="button" onclick="saveCampaign('DRAFT')"
                        class="px-6 py-2.5 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium">
                        Save as Draft
                    </button>
                    <button type="button" onclick="saveCampaign('ACTIVE')"
                        class="px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium shadow-lg">
                        <i class="fas fa-play mr-2"></i>Save & Activate
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enrollments Modal -->
    <div id="enrollmentsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl max-w-2xl w-full p-6 shadow-2xl">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-gray-800">üìã Campaign Enrollments</h2>
                <button onclick="hideEnrollmentsModal()" class="p-2 hover:bg-gray-100 rounded-full">
                    <i class="fas fa-times text-gray-500"></i>
                </button>
            </div>
            <div id="enrollmentsList" class="max-h-96 overflow-y-auto">
                <p class="text-gray-500 text-center py-8">Loading...</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin + '/api/v1';
        let allCampaigns = [];
        let stepIndex = 0;

        async function fetchWithAuth(url, options = {}) {
            const token = localStorage.getItem('authToken');
            const headers = {
                'Content-Type': 'application/json',
                ...(token && { 'Authorization': `Bearer ${token}` }),
                ...options.headers
            };
            const response = await fetch(url, { ...options, headers });
            if (response.status === 401) {
                localStorage.removeItem('authToken');
                window.location.href = '/login.html';
            }
            return response;
        }

        async function loadCampaigns() {
            try {
                const response = await fetchWithAuth(`${API_BASE}/drip-campaigns`);
                if (response.ok) {
                    const data = await response.json();
                    allCampaigns = data.data || [];
                    displayCampaigns(allCampaigns);
                    updateStats();
                }
            } catch (err) {
                console.error('Error loading campaigns:', err);
                displayCampaigns([]);
            }
        }

        function updateStats() {
            document.getElementById('totalCampaigns').textContent = allCampaigns.length;
            document.getElementById('activeCampaigns').textContent = allCampaigns.filter(c => c.status === 'ACTIVE').length;
            document.getElementById('totalEnrolled').textContent = allCampaigns.reduce((sum, c) => sum + (c.enrollmentCount || 0), 0);
            document.getElementById('messagesSent').textContent = allCampaigns.reduce((sum, c) => sum + (c.messagesSent || 0), 0);
        }

        function displayCampaigns(campaigns) {
            const container = document.getElementById('campaignsList');
            
            if (campaigns.length === 0) {
                container.innerHTML = `
                    <div class="p-12 text-center">
                        <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-water text-4xl text-blue-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">No drip campaigns yet</h3>
                        <p class="text-gray-500 mb-6">Create automated message sequences to nurture your leads</p>
                        <button onclick="showCreateModal()" class="gradient-btn text-white px-6 py-3 rounded-lg font-medium shadow-lg">
                            <i class="fas fa-plus mr-2"></i>Create Your First Campaign
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = campaigns.map(campaign => `
                <div class="p-6 hover:bg-gray-50 transition-all">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <h3 class="text-xl font-semibold text-gray-800">${campaign.name}</h3>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusColor(campaign.status)}">
                                    ${campaign.status}
                                </span>
                            </div>
                            ${campaign.description ? `<p class="text-gray-600 mb-2">${campaign.description}</p>` : ''}
                            
                            <div class="flex flex-wrap gap-4 text-sm">
                                <span class="text-gray-500">
                                    <i class="fas fa-list-ol mr-1"></i>${campaign.steps?.length || 0} steps
                                </span>
                                <span class="text-purple-600">
                                    <i class="fas fa-users mr-1"></i>${campaign.enrollmentCount || 0} enrolled
                                </span>
                                <span class="text-green-600">
                                    <i class="fas fa-paper-plane mr-1"></i>${campaign.messagesSent || 0} sent
                                </span>
                                <span class="text-gray-500">
                                    <i class="fas fa-bolt mr-1"></i>${getTriggerLabel(campaign.trigger)}
                                </span>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 ml-4">
                            <button onclick="viewEnrollments('${campaign.id}')" 
                                class="p-2.5 text-purple-600 hover:bg-purple-50 rounded-lg transition-all" title="View Enrollments">
                                <i class="fas fa-users"></i>
                            </button>
                            ${campaign.status === 'ACTIVE' ? `
                                <button onclick="pauseCampaign('${campaign.id}')" 
                                    class="p-2.5 text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all" title="Pause">
                                    <i class="fas fa-pause"></i>
                                </button>
                            ` : `
                                <button onclick="activateCampaign('${campaign.id}')" 
                                    class="p-2.5 text-green-600 hover:bg-green-50 rounded-lg transition-all" title="Activate">
                                    <i class="fas fa-play"></i>
                                </button>
                            `}
                            <button onclick="editCampaign('${campaign.id}')" 
                                class="p-2.5 text-blue-600 hover:bg-blue-50 rounded-lg transition-all" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteCampaign('${campaign.id}')" 
                                class="p-2.5 text-red-600 hover:bg-red-50 rounded-lg transition-all" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusColor(status) {
            const colors = {
                ACTIVE: 'bg-green-100 text-green-700',
                PAUSED: 'bg-yellow-100 text-yellow-700',
                DRAFT: 'bg-gray-100 text-gray-700',
                COMPLETED: 'bg-blue-100 text-blue-700'
            };
            return colors[status] || 'bg-gray-100 text-gray-700';
        }

        function getTriggerLabel(trigger) {
            const labels = {
                CONTACT_CREATED: 'On contact created',
                TAG_ADDED: 'On tag added',
                SEGMENT_JOINED: 'On segment join',
                MANUAL: 'Manual enrollment'
            };
            return labels[trigger] || trigger;
        }

        function showCreateModal() {
            document.getElementById('modalTitle').textContent = 'üíß Create Drip Campaign';
            document.getElementById('campaignId').value = '';
            document.getElementById('campaignName').value = '';
            document.getElementById('campaignDescription').value = '';
            document.getElementById('stepsContainer').innerHTML = '';
            stepIndex = 0;
            addStep(); // Add first step
            document.getElementById('campaignModal').classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('campaignModal').classList.add('hidden');
        }

        function addStep(stepData = null) {
            const container = document.getElementById('stepsContainer');
            const idx = stepIndex++;
            
            const stepHtml = `
                <div class="step-card bg-white border-2 border-gray-200 rounded-xl p-4 relative" id="step-${idx}">
                    <div class="flex items-start space-x-4">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="font-bold text-blue-600 step-number">${idx + 1}</span>
                        </div>
                        <div class="flex-1">
                            <div class="grid grid-cols-3 gap-3 mb-3">
                                <div>
                                    <label class="text-xs text-gray-500 mb-1 block">Delay</label>
                                    <div class="flex space-x-2">
                                        <input type="number" class="step-delay w-20 px-2 py-1.5 border rounded text-sm" 
                                            value="${stepData?.delayValue || 1}" min="1">
                                        <select class="step-delay-unit px-2 py-1.5 border rounded text-sm">
                                            <option value="MINUTES" ${stepData?.delayUnit === 'MINUTES' ? 'selected' : ''}>Minutes</option>
                                            <option value="HOURS" ${stepData?.delayUnit === 'HOURS' || !stepData ? 'selected' : ''}>Hours</option>
                                            <option value="DAYS" ${stepData?.delayUnit === 'DAYS' ? 'selected' : ''}>Days</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500 mb-1 block">Message Type</label>
                                    <select class="step-type w-full px-2 py-1.5 border rounded text-sm">
                                        <option value="TEXT" ${stepData?.messageType === 'TEXT' || !stepData ? 'selected' : ''}>Text</option>
                                        <option value="IMAGE" ${stepData?.messageType === 'IMAGE' ? 'selected' : ''}>Image</option>
                                        <option value="TEMPLATE" ${stepData?.messageType === 'TEMPLATE' ? 'selected' : ''}>Template</option>
                                    </select>
                                </div>
                                <div class="text-right">
                                    <button type="button" onclick="removeStep(${idx})" 
                                        class="p-1.5 text-red-500 hover:bg-red-50 rounded transition-all">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <textarea class="step-message w-full px-3 py-2 border rounded-lg text-sm" rows="2"
                                placeholder="Message content... Use {{name}} for personalization">${stepData?.content || ''}</textarea>
                        </div>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', stepHtml);
            updateStepNumbers();
        }

        function removeStep(idx) {
            const step = document.getElementById(`step-${idx}`);
            if (step) {
                step.remove();
                updateStepNumbers();
            }
        }

        function updateStepNumbers() {
            document.querySelectorAll('#stepsContainer .step-card').forEach((card, i) => {
                card.querySelector('.step-number').textContent = i + 1;
            });
        }

        function getSteps() {
            const steps = [];
            document.querySelectorAll('#stepsContainer .step-card').forEach((card, i) => {
                steps.push({
                    order: i + 1,
                    delayValue: parseInt(card.querySelector('.step-delay').value) || 1,
                    delayUnit: card.querySelector('.step-delay-unit').value,
                    messageType: card.querySelector('.step-type').value,
                    content: card.querySelector('.step-message').value
                });
            });
            return steps;
        }

        async function saveCampaign(status) {
            const id = document.getElementById('campaignId').value;
            const name = document.getElementById('campaignName').value.trim();
            const description = document.getElementById('campaignDescription').value.trim();
            const trigger = document.getElementById('trigger').value;
            const steps = getSteps();

            if (!name) {
                showNotification('Please enter a campaign name', 'error');
                return;
            }

            if (steps.length === 0) {
                showNotification('Please add at least one step', 'error');
                return;
            }

            const data = { name, description, trigger, status, steps };

            try {
                const url = id ? `${API_BASE}/drip-campaigns/${id}` : `${API_BASE}/drip-campaigns`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetchWithAuth(url, {
                    method,
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    hideModal();
                    loadCampaigns();
                    showNotification(id ? 'Campaign updated!' : 'Campaign created!', 'success');
                } else {
                    const error = await response.json();
                    showNotification('Error: ' + (error.message || 'Failed to save'), 'error');
                }
            } catch (err) {
                console.error('Save error:', err);
                showNotification('An error occurred', 'error');
            }
        }

        async function editCampaign(id) {
            try {
                const response = await fetchWithAuth(`${API_BASE}/drip-campaigns/${id}`);
                if (response.ok) {
                    const data = await response.json();
                    const campaign = data.data || data;
                    
                    document.getElementById('modalTitle').textContent = '‚úèÔ∏è Edit Campaign';
                    document.getElementById('campaignId').value = campaign.id;
                    document.getElementById('campaignName').value = campaign.name || '';
                    document.getElementById('campaignDescription').value = campaign.description || '';
                    document.getElementById('trigger').value = campaign.trigger || 'CONTACT_CREATED';
                    
                    document.getElementById('stepsContainer').innerHTML = '';
                    stepIndex = 0;
                    
                    if (campaign.steps && campaign.steps.length > 0) {
                        campaign.steps.forEach(s => addStep(s));
                    } else {
                        addStep();
                    }
                    
                    document.getElementById('campaignModal').classList.remove('hidden');
                }
            } catch (err) {
                console.error('Edit error:', err);
            }
        }

        async function deleteCampaign(id) {
            if (!confirm('Are you sure you want to delete this campaign?')) return;
            
            try {
                const response = await fetchWithAuth(`${API_BASE}/drip-campaigns/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadCampaigns();
                    showNotification('Campaign deleted', 'success');
                }
            } catch (err) {
                console.error('Delete error:', err);
            }
        }

        async function pauseCampaign(id) {
            try {
                const response = await fetchWithAuth(`${API_BASE}/drip-campaigns/${id}/pause`, {
                    method: 'POST'
                });
                if (response.ok) {
                    loadCampaigns();
                    showNotification('Campaign paused', 'success');
                }
            } catch (err) {
                console.error('Pause error:', err);
            }
        }

        async function activateCampaign(id) {
            try {
                const response = await fetchWithAuth(`${API_BASE}/drip-campaigns/${id}/activate`, {
                    method: 'POST'
                });
                if (response.ok) {
                    loadCampaigns();
                    showNotification('Campaign activated', 'success');
                }
            } catch (err) {
                console.error('Activate error:', err);
            }
        }

        async function viewEnrollments(id) {
            document.getElementById('enrollmentsModal').classList.remove('hidden');
            document.getElementById('enrollmentsList').innerHTML = '<p class="text-gray-500 text-center py-8"><i class="fas fa-spinner fa-spin mr-2"></i>Loading...</p>';
            
            try {
                const response = await fetchWithAuth(`${API_BASE}/drip-campaigns/${id}/enrollments`);
                if (response.ok) {
                    const data = await response.json();
                    const enrollments = data.data || [];
                    
                    if (enrollments.length === 0) {
                        document.getElementById('enrollmentsList').innerHTML = '<p class="text-gray-500 text-center py-8">No enrollments yet</p>';
                        return;
                    }
                    
                    document.getElementById('enrollmentsList').innerHTML = enrollments.map(e => `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-gray-500"></i>
                                </div>
                                <div>
                                    <div class="font-medium">${e.contact?.name || e.contact?.phoneNumber || 'Unknown'}</div>
                                    <div class="text-sm text-gray-500">Step ${e.currentStep || 1} of ${e.totalSteps || '?'}</div>
                                </div>
                            </div>
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                e.status === 'ACTIVE' ? 'bg-green-100 text-green-700' :
                                e.status === 'COMPLETED' ? 'bg-blue-100 text-blue-700' :
                                'bg-gray-100 text-gray-700'
                            }">${e.status}</span>
                        </div>
                    `).join('');
                }
            } catch (err) {
                document.getElementById('enrollmentsList').innerHTML = '<p class="text-red-500 text-center py-8">Error loading enrollments</p>';
            }
        }

        function hideEnrollmentsModal() {
            document.getElementById('enrollmentsModal').classList.add('hidden');
        }

        function showNotification(message, type = 'info') {
            const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500' };
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Filters
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const search = e.target.value.toLowerCase();
            const filtered = allCampaigns.filter(c => 
                c.name?.toLowerCase().includes(search) ||
                c.description?.toLowerCase().includes(search)
            );
            displayCampaigns(filtered);
        });

        document.getElementById('statusFilter').addEventListener('change', (e) => {
            const status = e.target.value;
            const filtered = status ? allCampaigns.filter(c => c.status === status) : allCampaigns;
            displayCampaigns(filtered);
        });

        // Initial load
        loadCampaigns();
    </script>
</body>
</html>
